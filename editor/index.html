<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>RDZPiT-JSON-Editor</title>

  <link href="css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
  <h1>RDZPiT-JSON-Editor v.0.0.1-alpha</h1>

  <div class="col-md-12">
    <div class="row">
      <div class="col-md-6">
        <div class="form-group">
          <label for="comment">Input JSON:</label>
          <textarea class="form-control" rows="5" id="inputJson" style="resize: none;"></textarea>
        </div>
      </div>
      <div class="col-md-6">
        <div class="form-group">
          <label for="comment">Output JSON:</label>
          <textarea onclick="this.select()" class="form-control" rows="5" id="outputJson"
            style="resize: none;"></textarea>
        </div>
      </div>
    </div>
    <button type="button" id="upload" class="btn btn-primary">⬇</button>
    <button type="button" id="convert" class="btn btn-primary" style="float: right">⬆</button>
    <hr>
    <div id="drownData">

    </div>
  </div>

  <script src="js/jquery-3.4.1.min.js"></script>
  <script src="js/bootstrap.min.js"></script>

  <script type="text/javascript">
    $("#upload").click(() => {
      var inputJson = JSON.parse($("textarea#inputJson").val());
      console.log(inputJson);
      drawData(inputJson);
    });

    $("#convert").click(() => {
      var inputJson = JSON.parse($("textarea#inputJson").val());
      console.log(inputJson);
      drawData(inputJson);
      $("#outputJson").val(JSON.stringify(inputJson));
      console.log($("#news").children());
    });

    var drawData = (input) => {
      $("#appendedData").remove();
      $("#drownData").append('<div id="appendedData"></div>');
      $("#appendedData").append('<label>' + 'News' + ':</label><div id="news" class="col-md-12"></div>');
      input['news'].forEach((element, index) => {
        $("#news").append('<div id="singleNews' + index + '" class="panel panel-default panel-body">');
        $("#singleNews" + index).append('<label>' + 'Date' + ':</label>');
        $("#singleNews" + index).append('<div class="input-group"><input id="date' + index + '" type="text" class="form-control" value="' + element.date + '"><span class="input-group-btn"><button id="getCurrentDateClick' + index + '" class="btn btn-default" type="button">Get current date</button></span></div>');
        $("#getCurrentDateClick" + index).click(() => {
          $("#date" + index).val(getCurrentDate());
        });
        // $("#news").append('<input type="text" class="form-control" value="' + element.date + '">');
        $("#singleNews" + index).append('<label>' + 'Header' + ':</label>');
        $("#singleNews" + index).append('<input id="header' + index + '" type="text" class="form-control" value="' + returnReplacedEscapedQuotes(element.header) + '">');
        $("#singleNews" + index).append('<label>' + 'Description' + ':</label>');
        $("#singleNews" + index).append('<textarea id="description' + index + '" class="form-control" rows="5">' + element.description + '</textarea>');
        $("#singleNews" + index).append('<label>' + 'Image' + ':</label>' + concatenateNewsImage(element.image, index));

      });

      // Object.keys(input).forEach(function (item) {
      //   $("#appendedData").append('<label for="usr">' + item + ':</label><input type="text" class="form-control"></div>');
      //   console.log(inputJson[item]); // value
      // });
    };

    var buildImageAddBtn = (index) => {
      return '<button id="imageAdd' + index + '" type="button" class="btn btn-success btn-xs">+</button>'
    };

    var getCurrentDate = () => {
      var today = new Date();
      var dd = String(today.getDate()).padStart(2, '0');
      var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
      var yyyy = today.getFullYear();

      return dd + '.' + mm + '.' + yyyy;
    };

    var returnReplacedEscapedQuotes = (text) => {
      return text.replace(/\"/g, "&quot;");
    };

    var concatenateNewsImage = (image, index) => {
      if (!image) {
        image = {};
        image.url = '';
        image.link = '';
      }
      var toReturn = '';
      toReturn += '<div id="imageDetails' + index + '" class="panel panel-default panel-body">';
      toReturn += '<label>' + 'URL' + ':</label><input type="text" class="form-control" value="' + image.url + '">';
      toReturn += '<label>' + 'Link' + ':</label><input type="text" class="form-control" value="' + image.link + '">';
      toReturn += '</div>';
      return toReturn;
    };
  </script>
</body>

</html>